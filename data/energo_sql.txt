1. Оборудование - связь с клиентами


select eq.*,c.code,c.name,c.idk_work,c.id as id_cl,u.* from eqm_equipment_tbl eq
 left join eqm_eqp_use_tbl as use on (use.code_eqp = eq.id) 
     left join eqm_eqp_tree_tbl ttr on ttr.code_eqp = eq.id
     left join eqm_tree_tbl tr on tr.id = ttr.id_tree
     left join clm_client_tbl as c on (c.id = coalesce (use.id_client, tr.id_client)) 
	join eqm_equipment_h as eqh on (eq.id=eqh.id and eqh.dt_b = (SELECT dt_b FROM eqm_equipment_h WHERE id = eq.id  order by dt_b desc limit 1 ) ) 
	join eqm_point_tbl AS dt on (dt.code_eqp= eq.id)
	left JOIN eqm_compens_station_inst_tbl AS area ON (eq.id=area.code_eqp) 
	left join cla_param_tbl as p on (dt.industry=p.id) 
	join eqm_eqp_tree_tbl as tt on (dt.code_eqp = tt.code_eqp) 
	join eqm_tree_tbl as t on (t.id = tt.id_tree) 
	left join eqm_area_tbl u on u.code_eqp=area.code_eqp_inst
	join (select distinct id,code,idk_work from clm_client_tbl) as c1 on (c1.id = t.id_client) 
     
where eq.id in(116541)

2. 

-- Связь счетчиков с клиентами
  select c.id,c.code,eq.num_eqp,eq.name_eqp,upper(sd.sap_meter_name) as matnr from eqm_meter_tbl m
 join eqm_equipment_tbl as eq on (m.code_eqp = eq.id)
  left join (select code as id,min(sap_cnt) as sap_meter_id from sap_meter_cnt where sap_cnt<>'' group by code) s on s.id::integer=m.id_type_eqp
  left join (select distinct sap_meter_id,sap_meter_name,group_schet from sap_device22) sd on s.sap_meter_id=sd.sap_meter_id
     left join eqm_eqp_use_tbl as use on (use.code_eqp = eq.id) 
     left join eqm_eqp_tree_tbl ttr on ttr.code_eqp = eq.id
     left join eqm_tree_tbl tr on tr.id = ttr.id_tree
     left join clm_client_tbl as c on (c.id = coalesce (use.id_client, tr.id_client)) 
  where length(trim(eq.num_eqp))>16


